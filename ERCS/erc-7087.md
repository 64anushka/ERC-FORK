---
eip: 7087
title: New features for Web3 URL in Auto Mode
description: Add features to Web3 URL in auto mode
author: Qi Zhou (@qizhou), Nicolas Deschildre (@nand2)
discussions-to: https://ethereum-magicians.org/t/erc-7087-mime-type-for-web3-url-in-auto-mode/14471
status: Draft
type: Standards Track
category: ERC
created: 2023-05-28
requires: 6860
---

## Abstract

This standard extends the [ERC-6860](./eip-6860.md) `web3://` standard in auto mode with new features :

- Determine the MIME type of a URL via additional query parameters.
- Ability to name fields when ``?returns=`` is used.

## Motivation

The web3 URL standard defines a way to determine the MIME type of a link in auto mode via the suffix of the last argument. However, most of existing contracts on Ethereum do not expect such suffix and thus the protocol cannot determine and return the right MIME type (e.g., contracts returning SVG images with token id as parameter). The standard proposes additional query parameters for a Web3 URL to determine the MIME type.

Additionally, when ``?returns=`` is used with returning complex structured data, an usual step after fetching the URL return is to map the returned arrays into proper named structs. To skip this tedious task, this standard propose a way to name the fields directly in ``?returns=``.

## Specification

### MIME type override

The standard introduces three query parameters to determine the MIME type.

- `mime.content=<contentType>`, where `<contentType>` is a MIME type defined in [RFC 6838](https://www.rfc-editor.org/rfc/rfc6838). If the `<contentType>` does not follow the structure of a MIME type, an error is thrown. After URL decoding, `<contentType>` is set as the value of the `Content-Type` header of the response; or
- `mime.type=<fileType>`, where `<fileType>` is a filename extension from which a MIME type is determined. If the filename extension is not recognized, an error is thrown. The MIME type is then set as the value of the `Content-Type` header of the response; or
- `mime.dataurl`, which indicates to decode the returned bytes as a [RFC 2397](https://www.rfc-editor.org/rfc/rfc2397) data URL. After decoding, the decoded body will be returned as the main output, and the MIME type specified in the data URL will be used. If the data cannot be parsed as data URL, an error will be returned.
  
If multiple query parameters are present, the last query parameter will be applied.  If none of the query parameter is specified, `Content-Type` is defined by [ERC-6860](./eip-6860.md).  If the `returns` query parameter is specified, the `mime.xxx` parameters will be ignored and the `Content-Type` will be defined by [ERC-6860](./eip-6860.md).

In [RFC 2234](https://www.rfc-editor.org/rfc/rfc2234) ABNF notation, the [ERC-6860](./eip-6860.md) syntax is :

```
attribute       = attrName "=" attrValue
attrName        = "returns"
                / "returnTypes"
attrValue       = [ "(" [ retTypes ] ")" ]
```

This standard evolves it into : 

```
attribute       = retAttr / mimeCAttr / mimeTAttr / mimeDAttr
retAttr         = retAttrName "=" retAttrValue
retAttrName     = "returns"
                / "returnTypes"
retAttrValue    = [ "(" [ retTypes ] ")" ]

mimeCAttr       = "mime.content=" mimeCAttrVal
mimeCAttrVal    = # ABNF of MIME type as in RFC 6838 
mimeTAttr       = "mime.type=" 1*( ALPHA / DIGIT )
mimeDAttr       = "mime.dataurl"
```


### ``?returns=`` field naming

[ERC-6860](./eip-6860.md) defines the syntax of ``?returns=``. This standard evolves this syntax.

In [RFC 2234](https://www.rfc-editor.org/rfc/rfc2234) ABNF notation, the [ERC-6860](./eip-6860.md) syntax is :

```
retType         = retRawType *( "[" [ %x31-39 *DIGIT ] "]" )
```

This standard evolves it into : 

```
retType         = [ retFieldName ":" ] retRawType *( "[" [ %x31-39 *DIGIT ] "]" )
retFieldName    = 1*retFieldChar
                \ %x22 1*( retFieldChar / retTypeReserved ) %x22 ; %x22 being double quote
retFieldChar    = unreserved / pct-encoded
                / "!" / "$" / "'" / "*" / "+" / ";" / "@"
retTypeReserved = ":" / "," / "(" / ")"

```

When field names are specified, the JSON returned is no longer an array but an object. As an basic example, ``?returns=(field1:uint)`` will return ``{"field1": 1234}``. 

If ``?returns=`` specifies multiple types, all must have a field name. At a tuple definition level or at the base level, if one type does not have a field name, then the formatting revert to a array at this level. As a basic example, ``?returns=(field1:(subField1:uint,string))`` will return ``{"field1": [1234, "abcd"]}``. 

At a tuple definition level or at the base level, if a field name is duplicate, an error will be throw.


### Examples

#### Example 1

```
web3://0x91cf36c92feb5c11d3f5fe3e8b9e212f7472ec14/accessorizedImageOf/1289?mime.content=image/svg%2Bxml
```

where the contract is in auto mode.

The protocol will call the contract `0x91cf36c92feb5c11d3f5fe3e8b9e212f7472ec14` with the message defined in [ERC-6860](./eip-6860.md) and the returned `Content-Type` header will be set to `image/svg+xml`.

#### Example 2

```
web3://0x91cf36c92feb5c11d3f5fe3e8b9e212f7472ec14/accessorizedImageOf/1289?mime.type=svg
```

where the contract is in auto mode.

The protocol will call the contract `0x91cf36c92feb5c11d3f5fe3e8b9e212f7472ec14` with the message defined in [ERC-6860](./eip-6860.md) and the returned `Content-Type` header will be set to `image/svg+xml`.

#### Example 3

```
web3://0xff9c1b15b16263c61d017ee9f65c50e4ae0113d7/tokenURI/100?mime.dataurl
```

where the contract is in auto mode, and the returned data is `data:application/json,["xx"]`.

The protocol will call the contract `0xff9c1b15b16263c61d017ee9f65c50e4ae0113d7` with the message defined in [ERC-6860](./eip-6860.md) and decode the data according to the [RFC 2397](https://www.rfc-editor.org/rfc/rfc2397) data URL standard. The returned output will be ``["xx"]`` and the returned `Content-Type` header will be set to `application/json`.

#### Example 4

```
web3://0x4e1f41613c9084fdb9e34e11fae9412427480e56/tokenSupplementalData/9352?returns=(tokenData:(tokenId:uint,level:uint,xCoordinate:uint,yCoordinate:uint,elevation:int,structureSpaceX:int,structureSpaceY:int,structureSpaceZ:int,zoneName:string,zoneColors:string[10],characterSet:string[9]))
```

where the contract is in auto mode.

The protocol will call the contract `0x91cf36c92feb5c11d3f5fe3e8b9e212f7472ec14` with the message defined in [ERC-6860](./eip-6860.md) and the JSON output will be as follow : 

```
{
    "tokenData": {
        "tokenId": "0x0",
        "level": "0x7",
        "xCoordinate": "0xc",
        "yCoordinate": "0x5",
        "elevation": "0x3",
        "structureSpaceX": "0x4d9100",
        "structureSpaceY": "0x36f160",
        "structureSpaceZ": "0xa5b330",
        "zoneName": "First Earth",
        "zoneColors": ["#cb8175","#e2a97e","#f0cf8e","#f6edcd","#f6edcd","#a8c8a6","#a8c8a6","#6d8d8a","#655057","#32282b"],
        "characterSet": ["█","▓","░","░","▒","▒","▒","▒","▓"]
    }
}
```

## Rationale

The standard uses three different query parameters rather than a single query paramter to avoid confusion - an implementer or a user can easily tell the expected returned MIME of a link.  Further, in auto mode, the query parameters are not used to form the EVM message (e.g., calldata) and thus it is safe to introduce new query parameters.

## Security Considerations

No security considerations were found.

## Copyright

Copyright and related rights waived via [CC0](../LICENSE.md).
